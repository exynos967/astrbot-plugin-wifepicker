## 新增群rbq排行
用于展示群友近30天被强娶的次数排行。使用方法/rbq排行。

## 📝 更新日志 (Changelog)

### ✨ 新增功能

* **关键词触发模式**：现在支持不带指令前缀（如直接发送“抽老婆”）触发功能。支持“完全匹配”、“开头匹配”及“包含匹配”三种模式。
* **双向锁定机制**（可选）：引入“互为老婆”逻辑。开启后，当 A 抽到 B 且 B 今日无记录时，会自动将 B 的老婆设为 A，实现“双向奔赴”。
* **剩余次数提示**：在抽取成功后的消息回复中，实时显示今日剩余的抽取次数。

### ⚙️ 逻辑优化

* **实时退群检测**：在抽取前会实时获取群成员列表。若用户已不在群内，将自动从活跃池中剔除，彻底杜绝抽到“幽灵老婆”的情况。
* **活跃池自动清理**：插件现在会自动清理超过 30 天未发言或已退群的用户数据，保持 `active_users.json` 精简。
* **全局数据缩减**：新增 `records.json` 自动清理逻辑，当全局记录过多时会自动裁切旧数据，防止插件运行时间过长导致内存或磁盘占用过高。
* **强娶功能加固**：优化了强娶的冷却时间计算与分群记录逻辑。

### 🛠️ 底层架构与稳定性

* **架构重构**：将业务逻辑与指令监听解耦，所有核心功能迁移至私有方法（如 `_cmd_draw_wife`），大幅提升代码复用性。
* **增强兼容性**：新增 OneBot 响应解析器，能够智能提取不同框架（NapCat/Gocqhttp 等）返回的 `message_id`。
* **防御性编程**：引入了大量的类型注解 (`Type Hints`) 和数据格式校验 (`isinstance`)，显著降低了因 API 返回异常数据导致插件崩溃的概率。
* **路径规范化**：采用 `get_astrbot_plugin_data_path` 管理数据路径，提升了在不同部署环境下的兼容性。

